node.js
react 사용시 보조도구일 뿐 얘에 대해 딥하게 알 필요 없음

npm이란?<br />
node package manager<br />
<img width="412" height="502" alt="image" src="https://github.com/user-attachments/assets/fef5f41f-6e8e-4f83-81aa-42f806351bc0" />
<img width="342" height="272" alt="image" src="https://github.com/user-attachments/assets/49859291-7c92-4e04-bada-ae1b6c3b3245" />


https://github.com/ESG-EDU/WEB_STUDY/tree/main/frontend/node<br />
문법이랑 차이법 중요.

`npm -v`: “Node.js라는 운영체제 프로그램이 제대로 설치되어 있는지 확인하는 행위”다.<br />
기본 type `Commonjs`인데 `ESM`로 바꿀 것 (왜? ESM이 더 자주 쓰이니까)

`scripts`안에 `test`가 있기 때문에 `npm run`만 하면 안되고 `npm run test`해야 터미널에서 정상 출력
```
D:\IDE\workspaces\study\20251226>npm run
Lifecycle scripts included in 20251226@1.0.0:
  test
    echo "Error: no test specified" && exit 1

D:\IDE\workspaces\study\20251226>npm run test

> 20251226@1.0.0 test
> echo "Error: no test specified" && exit 1

"Error: no test specified" 

D:\IDE\workspaces\study\20251226>
```

`node index.js`는 단독 명령어니까 프로젝트를 불러오는게 아니라서 `npm`을 써야 됨

`index.js`에서 출력을 해보려하면 
```
console.log("NPM 출력");
```
`package.json`에서 명령어를 만들어냄
```
  "scripts": {
    "start" : "node index.js",
    "test": "echo \"Error: no test specified\" && exit 1"
  }
```
- `start`대신 `run`으로 써도 됨 (우리가 정할 수 있음)
- 단, `react`로 가면 자동으로 정해짐

`"main"`의 이름 =/= `"start"`의 이름 = 파일명.js
<img width="843" height="348" alt="image" src="https://github.com/user-attachments/assets/167147dd-290f-4bba-a514-1e643537ed63" />

- `nodmon`은 패키지가 필요 -> 설치를 해야 한다.
- 어떻게? `npm i nodemon` 입력해서
- 어디에? `dir` 쳤을 때 `package.json`이 있는 곳에
  - `dir`쳤을 때 `node_modules` 폴더가 새로 생겨야 함
**- 정리: 각 프로젝트(refering to folder 20251226)마다 패키지를 설치해서 관리하고 있다.**

```
  "scripts": {
    "run": "node index.js",
    "dev": "nodemon index.js",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "dependencies": {
    "nodemon": "^3.1.11"
  }
```
- `dependencies`가 이미 보이면 설치 잘 되어 있다는 것
- `dev`를 써준다<br />
**폴더경로: D:\IDE\workspaces\study\20251226ex 에서 nodemon 지우고 (왜?? 용량이 커서) 나중에 터미널에서 `npm i`만 입력해도 위 dependencies를 불러와서 nodemon이 다시 알아서 설치됨**

<h3> GITHUB에 올릴 때 꼭 NODEMON을 지우고 올릴 것 </h3>

- 터미널에서 `npm run dev` 하면 NPM 계속 출력 중
- 일괄 작업 끝내고 싶으면 `ctrl`+`c` 입력하고 `y` 입력 또는 `ctrl`+`ctrl`
- `작업관리자` 창에서 돌아가고 있는 자바 파일 두개 `작업 끝내기` 버튼 눌러도 됨
- `작업관리자` 창에서 `프로세스` 창에서 어떤 프로그램들이 `성능` 보고 어떤 

<h3> Export/Import 개념 </h3>

- `main.js` 만들고
- `{ }` 그룹으로 묶어줘서 객체로 만들어줌

index.js
```
console.log("NPM 출력");

console.log("코드작성 중");

const { a, b } = require("./main.js");

console.log(a);
console.log(b);
```

main.js
```
const a = true;
const b = false;
module.exports = { a, b };
```

이렇게하면 터미널에 `npm run start` 입력시 true false 그대로 잘 나옴

<h3> Commonjs를 배우긴 하지만 이게 메인은 아님 우리는 ES를 쓸 것 </h3>

그럼 ESM을 사용하기 위해 
https://nodejs.org/ko > 여기서 코드 복사해 index.js에 복붙
package.json의 `type`을 `module`로 바꾸면 됨

`Listening on 127.0.0.1:3000`: 요청 대기 상태 (웹에서 request랑 respond가 있는데 respond가 GOlive했을 때 HELLO WORLD를 출력하는 것
- 신기한거: `res.end('')`안의 글자를 바꾼다고 해서 출력되는 내용이 바로 바뀌지 않음
- 터미널에서 `ctrl`+`ctrl`로 작업을 끝낸 뒤 GOlive하면 내용이 바뀜
- `<h1>` 같은 태그가 바뀌지 않는 이유도 `content-type`이 `text/plain`으로 되어 있기 때문
- 왜? HTML 처럼 UTF-8 같은게 설정되어 있지 않고 plain text로는 태그를 인식할 수 없기 때문
- 단, 바꿀 수 있는 방법 있음

index.html
```
const server = createServer((req, res) => {
  res.writeHead(200, { 
    'Content-Type': 'text/html; charset=utf-8' });
  res.end('<h1>안녕</h1>');
});
```
- `ctrl`+`ctrl`로 작업을 끝낸 뒤 화면 새로고침하면 반영됨
- 이 상태는 정적 파일과 같음
- 근데 backend는 동적 형태로 사용하기 위함이라서 *방문자수 보기* 라던가 넣어줌

<h3> 동적 상태 및 분리 </h3>

index.js
```
// server.mjs
import { createServer } from 'node:http';
import { text } from './main.js';

const server = createServer((req, res) => {
  res.writeHead(200, { 
    'Content-Type': 'text/html; charset=utf-8' });
  res.end(text()); 
});

// starts a simple http server locally on port 3000
server.listen(3000, '127.0.0.1', () => {
  console.log('Listening on 127.0.0.1:3000');
});

// run with `node server.mjs`
```

main.js
```
let cnt = 0;

function event1 () {
    console.log("호출");
    cnt = cnt + 1;
    return cnt;
}

export function text() {
    return `<h1>방문자 : ${event1()}</h1>`; 
}
```
-이렇게 분리를 해주는 이유? 가독성을 위해서
- 이렇게 하면? index.js는 더이상 변형되지 않고 (길어지지 않고) main.js에서만 수정하면 됨
